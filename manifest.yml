modules:
  function:
    # Main resolver handler
    - key: handler # This key should match the handler export in index.js
      handler: index.handler 
      
    # Function keys used by resolvers (all point to the main handler)
    - key: getPageContext
      handler: index.handler 
    - key: setNewSecret
      handler: index.handler
    - key: getOAuthLoginUrl
      handler: index.handler
    - key: getUserAuthStatus
      handler: index.handler
    - key: getAccessToken
      handler: index.handler
      
    # Dedicated handler for the OAuth callback (in oauth.js)
    - key: oauth-callback-handler
      handler: oauth.oauthCallbackHandler
      
    # Dedicated handler for the Zapier webhook (now in worklogHandler.js)
    - key: worklog-create-handler 
      handler: worklogHandler.handler # Point to the new handler

  webtrigger:
    # Ensure only one definition for each key
    - key: oauth-callback-trigger
      function: oauth-callback-handler # Points to the function key for the dedicated handler
      response:
        type: custom
    - key: zapier-webhook-trigger 
      function: worklog-create-handler # UPDATED: Points to the new worklog create handler function key
      response:
        type: custom
      
  jira:globalPage:
    - key: worklog-handler-global-page
      resource: main # Should match the resource key below
      resolver:
        function: handler # Should match the main resolver function key
      title: Worklog Handler
      layout: basic # Default layout

permissions:
  scopes:
    - 'storage:app'
    - 'read:jira-work'
    - 'write:jira-work'
    - 'read:jira-user'
    - 'read:me'
    - 'read:account'
  external:
    fetch:
      backend:
        - api.atlassian.com 
        - auth.atlassian.com

app:
  id: ari:cloud:ecosystem::app/8821cede-9470-4761-ba54-ad700c17298d
  # REMOVED: name (deprecated)
  runtime:
    name: nodejs22.x

resources:
  - key: main
    path: static/hello-world/build
